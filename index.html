<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>00965 NAV-Lag 套利助手（GitHub Pages 版 · 完整UI）</title>
  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:#f8fafc; }
    #boot, #err { max-width: 860px; margin: 24px auto; padding:16px 20px; border-radius:16px; background:#fff; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    code { background: #0f172a; color:#e2e8f0; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <div id="boot">
    <div style="font-size:20px;font-weight:700">正在載入 NAV-Lag（00965）…</div>
    <div id="boot-msg" style="margin-top:8px;color:#475569">若超過 5 秒沒有顯示畫面，請參考下方偵錯訊息。</div>
  </div>
  <div id="err" style="display:none"></div>
  <div id="root"></div>

  <script>
    function showError(message, details){
      var err = document.getElementById('err');
      err.style.display = 'block';
      err.innerHTML = '<div style="font-weight:700;color:#b91c1c">載入失敗</div>' +
        '<div style="margin-top:6px;white-space:pre-wrap;color:#1f2937">' + (message||'') + '</div>' +
        (details ? '<pre style="margin-top:8px;background:#0f172a;color:#e2e8f0;padding:10px;border-radius:8px;overflow:auto">' +
          details + '</pre>' : '');
    }
    window.addEventListener('error', function(e){
      showError('偵測到錯誤：', String(e.error||e.message||e.filename||e).slice(0,500));
    });
    function loadScript(src){
      return new Promise(function(resolve, reject){
        var s = document.createElement('script');
        s.src = src; s.onload = resolve; s.onerror = function(){ reject(new Error('載入失敗：' + src)); };
        document.head.appendChild(s);
      });
    }
    (async function boot(){
      try{
        try{
          await loadScript('https://unpkg.com/react@18/umd/react.production.min.js');
          await loadScript('https://unpkg.com/react-dom@18/umd/react-dom.production.min.js');
          await loadScript('https://unpkg.com/@babel/standalone/babel.min.js');
          await loadScript('https://cdn.tailwindcss.com');
        }catch(e1){
          document.getElementById('boot-msg').textContent = '主 CDN 無法連線，切換備援來源（jsDelivr）…';
          await loadScript('https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js');
          await loadScript('https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js');
          await loadScript('https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js');
          await loadScript('https://cdn.tailwindcss.com');
        }
        if(!window.React || !window.ReactDOM || !window.Babel){
          throw new Error('React/ReactDOM/Babel 未成功載入。可能被網路防火牆封鎖。');
        }
        document.getElementById('boot').style.display = 'none';
        var app = document.createElement('script');
        app.type = 'text/babel';
        app.text = "\nconst { useMemo, useState } = React;\n\nfunction num(v) { const n = parseFloat(String(v)); return Number.isFinite(n) ? n : 0; }\nfunction pct(n, digits = 2) { return `${n.toFixed(digits)}%`; }\nfunction classSignal(delta, buyT, sellT) {\n  if (!Number.isFinite(delta)) return \"\";\n  if (delta <= -Math.abs(buyT)) return \"BUY\";\n  if (delta >=  Math.abs(sellT)) return \"SELL\";\n  return \"NEUTRAL\";\n}\n\n// UI helpers\nfunction fmtPct(n, d = 3){ return Number.isFinite(n) ? `${n.toFixed(d)}%` : \"\u2014\"; }\nfunction signalClass(s){\n  if (s === \"BUY\") return \"bg-emerald-100 text-emerald-700 border-emerald-300\";\n  if (s === \"SELL\") return \"bg-rose-100 text-rose-700 border-rose-300\";\n  if (s === \"NEUTRAL\") return \"bg-slate-100 text-slate-700 border-slate-300\";\n  return \"bg-slate-100 text-slate-500 border-slate-200\";\n}\nfunction coverageLabel(w){ if(w>=95) return \"\u9ad8\"; if(w>=80) return \"\u4e2d\u7b49\"; return \"\u504f\u4f4e\"; }\n\n// ---------- parsing helpers ----------\nfunction stripBOM(s){ return String(s||\"\").replace(/^\\\\uFEFF/,\"\"); }\nfunction parseDelimitedLine(line){\n  const hasTab = line.indexOf(\"\\\\t\") >= 0;\n  const delim = hasTab ? \"\\\\t\" : \",\";\n  const out = []; let cur = \"\"; let inQ = false;\n  for (let i=0;i<line.length;i++){\n    const ch = line[i];\n    if (ch === '\"'){\n      if (inQ && line[i+1] === '\"'){ cur+='\"'; i++; }\n      else inQ = !inQ;\n    } else if (ch === delim && !inQ){ out.push(cur); cur = \"\"; }\n    else cur += ch;\n  }\n  out.push(cur);\n  return out;\n}\nfunction parseTextSimple(text){\n  const lines = stripBOM(text).split(/\\\\r?\\\\n/).map(l=>l.trim()).filter(Boolean);\n  if (!lines.length) return [];\n  const header = parseDelimitedLine(lines[0]).map(s=>s.trim().toLowerCase());\n  const hasHeader = [\"ticker\",\"name\",\"ccy\",\"weight\",\"prev\",\"curr\",\"prevfx\",\"currfx\"].every(h=>header.includes(h));\n  const body = hasHeader ? lines.slice(1) : lines;\n  return body.map(l => parseDelimitedLine(l));\n}\n\nconst DEFAULT_ROWS = [\n  { ticker: \"PLTR\", name: \"Palantir\", ccy: \"USD\", weight: 5.53 },\n  { ticker: \"329180.KS\", name: \"HD Hyundai Heavy\", ccy: \"KRW\", weight: 5.32 },\n  { ticker: \"012450.KS\", name: \"Hanwha Aerospace\", ccy: \"KRW\", weight: 5.22 },\n  { ticker: \"7011.T\", name: \"Mitsubishi Heavy\", ccy: \"JPY\", weight: 5.19 },\n  { ticker: \"6701.T\", name: \"NEC\", ccy: \"JPY\", weight: 4.93 },\n  { ticker: \"NVDA\", name: \"NVIDIA\", ccy: \"USD\", weight: 4.82 },\n  { ticker: \"2330.TW\", name: \"TSMC\", ccy: \"TWD\", weight: 4.66 },\n  { ticker: \"6503.T\", name: \"Mitsubishi Electric\", ccy: \"JPY\", weight: 4.61 },\n  { ticker: \"GE\", name: \"GE Aerospace\", ccy: \"USD\", weight: 4.43 },\n  { ticker: \"6702.T\", name: \"Fujitsu\", ccy: \"JPY\", weight: 4.24 },\n];\n\nfunction App() {\n  const [rows, setRows] = useState(\n    DEFAULT_ROWS.map(r => ({ ...r, prev:\"\", curr:\"\", prevFx: r.ccy===\"TWD\"?\"1\":\"\", currFx: r.ccy===\"TWD\"?\"1\":\"\" }))\n  );\n  const [prevNav, setPrevNav] = useState(\"\");\n  const [openPrice, setOpenPrice] = useState(\"\");\n  const [buyThresh, setBuyThresh] = useState(\"0.50\");\n  const [sellThresh, setSellThresh] = useState(\"0.50\");\n  const [bulkText, setBulkText] = useState(\"\");\n  const [testLog, setTestLog] = useState(null);\n  const [normalize, setNormalize] = useState(false);\n  // \u5206\u7d1a\u9580\u6abb\uff08\u6210\u5206\u80a1 NAV-Lag \u5f37\u5f31\uff09\n  const [bandStrong, setBandStrong] = useState(\"2\");     // \u2265 +2% \u5f37\u52e2\uff08\u504f\u8cb4\uff09\n  const [bandMild, setBandMild] = useState(\"1\");        // \u2265 +1% \u504f\u5f37\uff08\u504f\u8cb4\uff09\n  const [bandMildNeg, setBandMildNeg] = useState(\"-1\"); // \u2264 -1% \u504f\u5f31\uff08\u504f\u4fbf\u5b9c\uff09\n  const [bandStrongNeg, setBandStrongNeg] = useState(\"-2\"); // \u2264 -2% \u5f37\u5f31\uff08\u504f\u4fbf\u5b9c\uff09\n\n  function addEmptyRow(){\n    setRows(r=>[...r,{ ticker:\"\", name:\"\", ccy:\"USD\", weight:\"\", prev:\"\", curr:\"\", prevFx:\"\", currFx:\"\" }]);\n  }\n\n  function parseBulk(){\n    const arr = parseTextSimple(bulkText);\n    if (!arr.length) return;\n    const mapped = arr.map(cols => ({\n      ticker: cols[0]||\"\", name: cols[1]||\"\",\n      ccy: (cols[2]||\"USD\").toUpperCase(), weight: cols[3]||\"\",\n      prev: cols[4]||\"\", curr: cols[5]||\"\",\n      prevFx: ((cols[2]||\"\").toUpperCase()===\"TWD\")?\"1\":(cols[6]||\"\"),\n      currFx: ((cols[2]||\"\").toUpperCase()===\"TWD\")?\"1\":(cols[7]||\"\"),\n    }));\n    setRows(mapped);\n  }\n\n  async function loadCsvUrl(){\n    const el = document.getElementById(\"csvUrl\");\n    const url = el && el.value.trim();\n    if (!url) return;\n    try{\n      const res = await fetch(url);\n      const text = await res.text();\n      const lines = stripBOM(text).split(/\\\\r?\\\\n/).map(l=>l.trim()).filter(Boolean);\n      if (!lines.length) return;\n      const header = lines[0].toLowerCase();\n      const dataLines = header.includes(\"ticker\") ? lines.slice(1) : lines;\n      const parsed = dataLines.map(l => l\n        .split(/,(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/)\n        .map(s => s.replace(/^\"|\"$/g,\"\").trim())\n      );\n      const mapped = parsed.map(cols => ({\n        ticker: cols[0]||\"\", name: cols[1]||\"\",\n        ccy: (cols[2]||\"USD\").toUpperCase(), weight: cols[3]||\"\",\n        prev: cols[4]||\"\", curr: cols[5]||\"\",\n        prevFx: ((cols[2]||\"\").toUpperCase()===\"TWD\")?\"1\":(cols[6]||\"\"),\n        currFx: ((cols[2]||\"\").toUpperCase()===\"TWD\")?\"1\":(cols[7]||\"\"),\n      }));\n      setRows(mapped);\n    }catch(e){\n      alert(\"\u8f09\u5165\u5931\u6557\uff0c\u8acb\u78ba\u8a8d\u9023\u7d50\u662f\u5426\u70ba\u516c\u958b CSV\");\n    }\n  }\n\n  function runSelfTests(){\n    const logs = [];\n    // CSV + LF\n    const csv = `ticker,name,ccy,weight,prev,curr,prevFx,currFx\\\\nPLTR,Palantir,USD,5,100,105,29.5,29.6\\\\n2330.TW,TSMC,TWD,4,100,101,1,1`;\n    const r1 = parseTextSimple(csv);\n    logs.push((r1.length===2 && r1[0][0]===\"PLTR\" && r1[1][2]===\"TWD\") ? \"\u2705 CSV/LF OK\" : \"\u274c CSV/LF Failed\");\n    // TSV + CRLF\n    const tsv = `ticker\\\\tname\\\\tccy\\\\tweight\\\\tprev\\\\tcurr\\\\tprevFx\\\\tcurrFx\\\\r\\\\n7011.T\\\\tMitsubishi Heavy\\\\tJPY\\\\t5\\\\t3546\\\\t3872\\\\t0.2035\\\\t0.2025`;\n    const r2 = parseTextSimple(tsv);\n    logs.push((r2.length===1 && r2[0][0]===\"7011.T\" && r2[0][2]===\"JPY\") ? \"\u2705 TSV/CRLF OK\" : \"\u274c TSV/CRLF Failed\");\n    // Quoted fields\n    const quoted = `ticker,name,ccy,weight,prev,curr,prevFx,currFx\\\\n\"7011.T\",\"Mitsubishi, Heavy\",\"JPY\",5,3546,3872,0.2035,0.2025`;\n    const r3 = parseTextSimple(quoted);\n    logs.push((r3[0][1]===\"Mitsubishi, Heavy\") ? \"\u2705 Quoted OK\" : \"\u274c Quoted Failed\");\n    // BOM + \u7121\u8868\u982d\n    const bomHeaderless = `\\\\uFEFFPLTR,Palantir,USD,5,100,105,29.5,29.6\\\\n2330.TW,TSMC,TWD,4,100,101,1,1`;\n    const r4 = parseTextSimple(bomHeaderless);\n    logs.push((r4.length===2 && r4[0][0]===\"PLTR\" && r4[1][2]===\"TWD\") ? \"\u2705 BOM/Headerless OK\" : \"\u274c BOM/Headerless Failed\");\n\n    setTestLog(logs.join(\"\\\\n\"));\n  }\n\n  const totals = useMemo(() => {\n    let totalWeight = 0, totalPpts = 0;\n    const enriched = rows.map(r=>{\n      const w = num(r.weight), prev = num(r.prev), curr = num(r.curr);\n      const prevFx = r.ccy===\"TWD\" ? 1 : num(r.prevFx);\n      const currFx = r.ccy===\"TWD\" ? 1 : num(r.currFx);\n      const localRet = (prev>0 && curr>0) ? (curr/prev - 1)*100 : 0;\n      const fxRet    = (prevFx>0 && currFx>0) ? (currFx/prevFx - 1)*100 : 0;\n      const adjRet   = ((1+localRet/100)*(1+fxRet/100)-1)*100;\n      const contrib  = (w * adjRet)/100; // p.p.\n      totalWeight += w; totalPpts += contrib;\n      return { ...r, localRet, fxRet, adjRet, contrib };\n    });\n    return { totalWeight, totalPpts, enriched };\n  }, [rows]);\n\n  const normalizedPpts = useMemo(() => {\n    const tw = totals.totalWeight;\n    return tw > 0 ? totals.totalPpts * (100 / tw) : 0;\n  }, [totals.totalPpts, totals.totalWeight]);\n\n  // \u9810\u6e2c NAV\uff08\u672a\u6b78\u4e00\u3001\u6b78\u4e00\u3001\u6700\u7d42\uff09\u8207\u76e4\u50f9\u6ea2\u6298\n  const predictions = useMemo(()=>{\n    const prev = num(prevNav);\n    const rawP = totals.totalPpts;\n    const normP = normalizedPpts;\n    const navRaw = prev>0 ? prev * (1 + rawP/100) : NaN;\n    const navNorm = prev>0 ? prev * (1 + normP/100) : NaN;\n    const navFinal = normalize ? navNorm : navRaw;\n    const open = num(openPrice);\n    const premPct = (Number.isFinite(navFinal) && open>0) ? (open/navFinal - 1)*100 : NaN;\n    return { navRaw, navNorm, navFinal, premPct };\n  }, [prevNav, totals.totalPpts, normalizedPpts, normalize, openPrice]);\n\n  const impliedMove = useMemo(()=>{\n    const prev = num(prevNav), open = num(openPrice);\n    if (prev<=0 || open<=0) return { movePct: NaN, deltaTheoretical: NaN, signal:\"\" };\n    const movePct = (open/prev - 1)*100;\n    const basePpts = normalize ? normalizedPpts : totals.totalPpts;\n    const deltaTheoretical = movePct - basePpts;\n    const signal = classSignal(deltaTheoretical, num(buyThresh), num(sellThresh));\n    return { movePct, deltaTheoretical, signal };\n  }, [prevNav, openPrice, totals.totalPpts, normalizedPpts, buyThresh, sellThresh, normalize]);\n\n  // \u6210\u5206\u80a1\u5f37\u5f31\u5206\u7d1a\uff08\u4ee5\u53f0\u5e63\u8abf\u6574\u5f8c\u5831\u916c adjRet \u70ba\u57fa\u6e96\uff09\n  function gradeOf(adjRet){\n    const s = num(bandStrong);\n    const m = num(bandMild);\n    const mn = num(bandMildNeg);\n    const sn = num(bandStrongNeg);\n    if (!Number.isFinite(adjRet)) return {label:\"\u2014\", cls:\"bg-slate-100 text-slate-600 border-slate-200\"};\n    if (adjRet >= s) return {label:\"\u5f37\u52e2/\u504f\u8cb4\", cls:\"bg-rose-100 text-rose-700 border-rose-300\"};\n    if (adjRet >= m) return {label:\"\u504f\u5f37/\u7565\u8cb4\", cls:\"bg-orange-100 text-orange-700 border-orange-300\"};\n    if (adjRet <= sn) return {label:\"\u5f37\u5f31/\u504f\u4fbf\u5b9c\", cls:\"bg-emerald-100 text-emerald-700 border-emerald-300\"};\n    if (adjRet <= mn) return {label:\"\u504f\u5f31/\u7565\u4fbf\u5b9c\", cls:\"bg-emerald-50 text-emerald-700 border-emerald-200\"};\n    return {label:\"\u4e2d\u6027\", cls:\"bg-slate-100 text-slate-700 border-slate-300\"};\n  }\n\n  const ranked = useMemo(()=>{\n    const arr = totals.enriched.map((r, idx)=>({\n      idx,\n      ticker: r.ticker, name: r.name, ccy: r.ccy,\n      weight: num(r.weight), adjRet: r.adjRet, contrib: r.contrib\n    }));\n    return arr.sort((a,b)=> a.adjRet - b.adjRet);\n  }, [totals.enriched, rows]);\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 py-8\">\n      <div className=\"max-w-7xl mx-auto px-4\">\n        <header className=\"mb-6\">\n          <h1 className=\"text-2xl md:text-3xl font-bold tracking-tight\">00965 NAV-Lag \u5957\u5229\u52a9\u624b\uff08Core 10 / 25 \u652f\u63f4\uff09</h1>\n          <p className=\"text-slate-600 mt-1\">\u8cbc\u4e0a CSV \u6216\u8868\u55ae\u7de8\u8f2f\uff0c\u8f38\u5165\u6628\u65e5 NAV \u8207\u4eca\u65e5\u958b\u76e4\u50f9\uff0c\u5373\u6642\u8a08\u7b97\u7406\u8ad6\u8ca2\u737b\u3001\u9810\u6e2c NAV \u8207 BUY/SELL \u8a0a\u865f\u3002</p>\n        </header>\n\n        {/* Summary Card */}\n        <div className=\"bg-white rounded-2xl shadow p-5 mb-6\">\n          <div className=\"grid md:grid-cols-5 gap-4\">\n            <div>\n              <div className=\"text-xs text-slate-500\">\u958b\u76e4%</div>\n              <div className=\"text-2xl font-semibold\">{fmtPct(impliedMove.movePct, 3)}</div>\n            </div>\n            <div>\n              <div className=\"text-xs text-slate-500\">\u7406\u8ad6\u8ca2\u737b\uff08p.p.\uff09</div>\n              <div className=\"text-sm text-slate-700\">\u672a\u6b78\u4e00\uff1a<span className=\"font-semibold\">{fmtPct(totals.totalPpts, 3)}</span></div>\n              <div className=\"text-sm text-slate-700\">\u6b78\u4e00\u5316\uff1a<span className=\"font-semibold\">{fmtPct(normalizedPpts, 3)}</span></div>\n            </div>\n            <div>\n              <div className=\"text-xs text-slate-500\">\u9810\u6e2c NAV\uff08TWD\uff09</div>\n              <div className=\"text-sm text-slate-700\">\u672a\u6b78\u4e00\uff1a<span className=\"font-semibold\">{Number.isFinite(predictions.navRaw) ? predictions.navRaw.toFixed(3) : '\u2014'}</span></div>\n              <div className=\"text-sm text-slate-700\">\u6b78\u4e00\u5316\uff1a<span className=\"font-semibold\">{Number.isFinite(predictions.navNorm) ? predictions.navNorm.toFixed(3) : '\u2014'}</span></div>\n              <div className=\"text-sm text-slate-700\">\u6700\u7d42\uff1a<span className=\"font-semibold\">{Number.isFinite(predictions.navFinal) ? predictions.navFinal.toFixed(3) : '\u2014'}</span></div>\n            </div>\n            <div>\n              <div className=\"text-xs text-slate-500\">\u76e4\u50f9\u6ea2\u6298</div>\n              <div className=\"text-2xl font-semibold\">{fmtPct(predictions.premPct, 2)}</div>\n              <div className=\"text-xs text-slate-500 mt-1\">\u8207\u6700\u7d42\u9810\u6e2c NAV \u76f8\u6bd4</div>\n            </div>\n            <div>\n              <div className=\"text-xs text-slate-500\">\u6700\u7d42\u8a0a\u865f</div>\n              <div className={`inline-block mt-1 px-3 py-1.5 border rounded-full font-semibold ${signalClass(impliedMove.signal)}`}>{impliedMove.signal||\"\u2014\"}</div>\n              <div className=\"mt-3\">\n                <div className=\"flex justify-between text-xs text-slate-500\">\n                  <span>\u8986\u84cb\u5ea6\uff1a{totals.totalWeight.toFixed(2)}%</span>\n                  <span>{coverageLabel(totals.totalWeight)}\u4fe1\u5fc3</span>\n                </div>\n                <div className=\"h-2 bg-slate-200 rounded-full overflow-hidden mt-1\">\n                  <div className=\"h-full bg-slate-700\" style={{width: `${Math.max(0, Math.min(100, totals.totalWeight))}%`}}></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* CSV URL Loader */}\n        <div className=\"bg\u767d\u8272 rounded-2xl shadow p-5 mb-6\">\n          <h2 className=\"text-lg font-semibold mb-2\">\u4f86\u6e90\u4e00\u9375\u8f09\u5165\uff08\u516c\u958b CSV \u9023\u7d50\uff09</h2>\n          <p className=\"text-sm text-slate-600 mb-3\">\u8868\u982d\u9700\u542b\uff1a<code>ticker,name,ccy,weight,prev,curr,prevFx,currFx</code></p>\n          <div className=\"flex gap-2 items-center\">\n            <input id=\"csvUrl\" className=\"flex-1 border rounded-xl px-3 py-2\" placeholder=\"\u8cbc\u4e0a CSV \u9023\u7d50\uff08\u4f8b\uff1ahttps://docs.google.com/.../export?format=csv\uff09\" />\n            <button onClick={loadCsvUrl} className=\"px-3 py-2 rounded-xl border shadow-sm\">\u8f09\u5165</button>\n          </div>\n        </div>\n\n        {/* Dashboard */}\n        <div className=\"grid md:grid-cols-3 gap-4 mb-6\">\n          <div className=\"bg-white rounded-2xl shadow p-4\">\n            <div className=\"text-sm text-slate-500 mb-1\">\u6628\u65e5 NAV\uff08TWD\uff09</div>\n            <input className=\"w-full border rounded-xl px-3 py-2\" value={prevNav} onChange={e=>setPrevNav(e.target.value)} placeholder=\"\u4f8b\uff1a20.54\" />\n            <div className=\"text-sm text-slate-500 mt-4 mb-1\">\u4eca\u65e5\u958b\u76e4\u50f9\uff08TWD\uff09</div>\n            <input className=\"w-full border rounded-xl px-3 py-2\" value={openPrice} onChange={e=>setOpenPrice(e.target.value)} placeholder=\"\u4f8b\uff1a20.61\" />\n          </div>\n          <div className=\"bg-white rounded-2xl shadow p-4\">\n            <div className=\"text-sm text-slate-500 mb-1\">\u8a0a\u865f\u9580\u6abb\uff08\u504f\u96e2%\uff09</div>\n            <div className=\"grid grid-cols-2 gap-3\">\n              <label className=\"text-sm\">BUY \u2264\n                <input className=\"ml-2 w-24 border rounded-xl px-2 py-1\" value={buyThresh} onChange={e=>setBuyThresh(e.target.value)} />\n              </label>\n              <label className=\"text-sm\">SELL \u2265\n                <input className=\"ml-2 w-24 border rounded-xl px-2 py-1\" value={sellThresh} onChange={e=>setSellThresh(e.target.value)} />\n              </label>\n            </div>\n            <div className=\"text-xs text-slate-500 mt-2\">\u504f\u96e2 = \u958b\u76e4% \u2212 \u7406\u8ad6\u8ca2\u737b(p.p.)</div>\n          </div>\n          <div className=\"bg-white rounded-2xl shadow p-4 flex flex-col justify-between\">\n            <div>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"text-sm text-slate-500\">\u6b0a\u91cd\u5408\u8a08</div>\n                  <div className=\"text-2xl font-semibold\">{totals.totalWeight.toFixed(2)}%</div>\n                </div>\n                <label className=\"flex items-center gap-2 text-sm text-slate-600\">\n                  <input type=\"checkbox\" className=\"w-4 h-4\" checked={normalize} onChange={e=>setNormalize(e.target.checked)} />\n                  \u6b0a\u91cd\u6b78\u4e00\u5316\u81f3 100%\n                </label>\n              </div>\n              <div className=\"text-sm text-slate-500 mt-3\">\u7406\u8ad6\u8ca2\u737b\uff08p.p.\uff09</div>\n              <div className=\"text-lg font-semibold\">{normalize ? normalizedPpts.toFixed(3) : totals.totalPpts.toFixed(3)}</div>\n              <div className=\"text-xs text-slate-500 mt-1\">{normalize ? `\uff08\u4ee5 100% \u6b0a\u91cd\u8a08\u7b97\uff09` : `\uff08\u4ee5\u76ee\u524d ${totals.totalWeight.toFixed(2)}% \u6b0a\u91cd\u8a08\u7b97\uff09`}</div>\n\n              <div className=\"mt-4 border-t pt-3\">\n                <div className=\"text-sm text-slate-500\">\u9810\u6e2c NAV\uff08TWD\uff09</div>\n                <div className=\"text-sm text-slate-700\">\u672a\u6b78\u4e00\u5316\uff1a<span className=\"font-semibold\">{Number.isFinite(predictions.navRaw) ? predictions.navRaw.toFixed(3) : '\u2014'}</span></div>\n                <div className=\"text-sm text-slate-700\">\u6b78\u4e00\u5316\uff1a<span className=\"font-semibold\">{Number.isFinite(predictions.navNorm) ? predictions.navNorm.toFixed(3) : '\u2014'}</span></div>\n                <div className=\"text-sm text-slate-700\">\u6700\u7d42\uff08\u4f9d\u52fe\u9078\uff09\uff1a<span className=\"font-semibold\">{Number.isFinite(predictions.navFinal) ? predictions.navFinal.toFixed(3) : '\u2014'}</span></div>\n                <div className=\"text-xs text-slate-500 mt-1\">\u76e4\u50f9\u6ea2\u6298\uff1a{Number.isFinite(predictions.premPct) ? `${predictions.premPct.toFixed(2)}%` : '\u2014'}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* \u5f37\u5f31\u5206\u7d1a */}\n        <div className=\"bg-white rounded-2xl shadow p-5 mb-6\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h2 className=\"text-lg font-semibold\">\u6210\u5206\u80a1 NAV-Lag \u5f37\u5f31\u5206\u7d1a\uff08\u5957\u5229\u53c3\u8003\uff09</h2>\n            <div className=\"flex items-center gap-3 text-xs text-slate-600\">\n              <span>\u9580\u6abb\u8a2d\u5b9a\uff08%\uff09\uff1a</span>\n              <label className=\"flex items-center gap-1\">\u5f37\u5f31\u2264\n                <input className=\"w-16 border rounded px-1 py-0.5 text-right\" value={bandStrongNeg} onChange={e=>setBandStrongNeg(e.target.value)} />\n              </label>\n              <label className=\"flex items-center gap-1\">\u504f\u5f31\u2264\n                <input className=\"w-16 border rounded px-1 py-0.5 text-right\" value={bandMildNeg} onChange={e=>setBandMildNeg(e.target.value)} />\n              </label>\n              <label className=\"flex items-center gap-1\">\u504f\u5f37\u2265\n                <input className=\"w-16 border rounded px-1 py-0.5 text-right\" value={bandMild} onChange={e=>setBandMild(e.target.value)} />\n              </label>\n              <label className=\"flex items-center gap-1\">\u5f37\u52e2\u2265\n                <input className=\"w-16 border rounded px-1 py-0.5 text-right\" value={bandStrong} onChange={e=>setBandStrong(e.target.value)} />\n              </label>\n            </div>\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full text-sm\">\n              <thead>\n                <tr className=\"bg-slate-100 text-slate-600\">\n                  <th className=\"px-3 py-2 text-left\">#</th>\n                  <th className=\"px-3 py-2 text-left\">\u4ee3\u78bc</th>\n                  <th className=\"px-3 py-2 text-left\">\u540d\u7a31</th>\n                  <th className=\"px-3 py-2 text-right\">\u6b0a\u91cd%</th>\n                  <th className=\"px-3 py-2 text-right\">\u53f0\u5e63\u8abf\u6574\u5f8c\u5831\u916c%</th>\n                  <th className=\"px-3 py-2 text-right\">\u5c0d NAV \u8ca2\u737b(p.p.)</th>\n                  <th className=\"px-3 py-2 text-left\">\u5206\u7d1a</th>\n                </tr>\n              </thead>\n              <tbody>\n                {ranked.map((r, i)=>{\n                  const g = gradeOf(r.adjRet);\n                  return (\n                    <tr key={`${r.ticker}-${i}`} className=\"border-t\">\n                      <td className=\"px-3 py-2\">{i+1}</td>\n                      <td className=\"px-3 py-2 whitespace-nowrap font-medium\">{r.ticker}</td>\n                      <td className=\"px-3 py-2 whitespace-nowrap\">{r.name}</td>\n                      <td className=\"px-3 py-2 text-right\">{r.weight.toFixed(2)}%</td>\n                      <td className=\"px-3 py-2 text-right\">{pct(r.adjRet)}</td>\n                      <td className=\"px-3 py-2 text-right\">{r.contrib.toFixed(3)}</td>\n                      <td className=\"px-3 py-2\">\n                        <span className={`inline-block px-2 py-0.5 border rounded-full text-xs ${g.cls}`}>{g.label}</span>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n              <tfoot>\n                <tr className=\"bg-slate-100 font-semibold\">\n                  <td className=\"px-3 py-2\" colSpan={2}>\u5408\u8a08</td>\n                  <td className=\"px-3 py-2 text-right\">{totals.totalWeight.toFixed(2)}%</td>\n                  <td className=\"px-3 py-2\" colSpan={7}></td>\n                  <td className=\"px-3 py-2 text-right\">\u2014</td>\n                  <td className=\"px-3 py-2 text-right\">{totals.totalPpts.toFixed(3)}</td>\n                </tr>\n              </tfoot>\n            </table>\n          </div>\n          <div className=\"mt-3 text-xs text-slate-500\">\u8aaa\u660e\uff1a\u4f9d\u300c\u53f0\u5e63\u8abf\u6574\u5f8c\u5831\u916c%\uff08adjRet\uff09\u300d\u7531\u4f4e\u2192\u9ad8\u6392\u5e8f\uff1b\u8ca0\u503c\uff08\u4fbf\u5b9c\uff09\u5728\u4e0a\u65b9\u3001\u6b63\u503c\uff08\u504f\u8cb4\uff09\u5728\u4e0b\u65b9\u3002\u9580\u6abb\u53ef\u8abf\u6574\uff0c\u4ee5\u4fbf\u4f5c\u70ba\u672a\u4f86\u5e7e\u5929\u7684\u5957\u5229\u89c0\u5bdf\u6e05\u55ae\u3002</div>\n        </div>\n\n        {/* Table */}\n        <div className=\"bg-white rounded-2xl shadow p-5\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h2 className=\"text-lg font-semibold\">\u6210\u5206\u80a1\u660e\u7d30\uff08\u53ef\u81ea\u7531\u589e\u522a\u5217\uff09</h2>\n            <div className=\"flex items-center gap-2\">\n              <button onClick={addEmptyRow} className=\"px-3 py-1.5 rounded-xl border shadow-sm\">+ \u65b0\u589e\u4e00\u5217</button>\n              <div className=\"text-xs text-slate-500\">\u53ef\u64f4\u5145\u5230 25 \u6a94\u6216\u66f4\u591a</div>\n            </div>\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full text-sm\">\n              <thead>\n                <tr className=\"bg-slate-100 text-slate-600\">\n                  <th className=\"px-3 py-2 text-left\">\u4ee3\u78bc</th>\n                  <th className=\"px-3 py-2 text-left\">\u540d\u7a31</th>\n                  <th className=\"px-3 py-2\">\u6b0a\u91cd%</th>\n                  <th className=\"px-3 py-2\">\u5e63\u5225</th>\n                  <th className=\"px-3 py-2\">\u524d\u4e00\u65e5\u6536\u76e4</th>\n                  <th className=\"px-3 py-2\">\u4eca\u65e5\u6536\u76e4</th>\n                  <th className=\"px-3 py-2\">\u524d\u4e00\u65e5\u532f\u7387<br/>(TWD/\u5e63\u5225)</th>\n                  <th className=\"px-3 py-2\">\u4eca\u65e5\u532f\u7387<br/>(TWD/\u5e63\u5225)</th>\n                  <th className=\"px-3 py-2\">\u7576\u5730\u5831\u916c%</th>\n                  <th className=\"px-3 py-2\">\u532f\u7387\u5831\u916c%</th>\n                  <th className=\"px-3 py-2\">\u53f0\u5e63\u8abf\u6574\u5f8c\u5831\u916c%</th>\n                  <th className=\"px-3 py-2\">\u5c0d NAV \u8ca2\u737b(p.p.)</th>\n                </tr>\n              </thead>\n              <tbody>\n                {totals.enriched.map((r, idx) => (\n                  <tr key={idx} className=\"border-t\">\n                    <td className=\"px-3 py-2 font-medium whitespace-nowrap\">\n                      <input className=\"w-28 border rounded-md px-2 py-1\" value={rows[idx].ticker}\n                        onChange={e=>{ const c=[...rows]; c[idx].ticker=e.target.value; setRows(c); }} />\n                    </td>\n                    <td className=\"px-3 py-2 whitespace-nowrap\">\n                      <input className=\"w-40 border rounded-md px-2 py-1\" value={rows[idx].name}\n                        onChange={e=>{ const c=[...rows]; c[idx].name=e.target.value; setRows(c); }} />\n                    </td>\n                    <td className=\"px-3 py-2 text-right\">\n                      <input className=\"w-20 text-right border rounded-md px-2 py-1\" value={rows[idx].weight}\n                        onChange={e=>{ const c=[...rows]; c[idx].weight=e.target.value; setRows(c); }} />\n                    </td>\n                    <td className=\"px-3 py-2 text-center\">\n                      <input className=\"w-16 text-center border rounded-md px-2 py-1\" value={rows[idx].ccy}\n                        onChange={e=>{ const c=[...rows]; c[idx].ccy=e.target.value; setRows(c); }} />\n                    </td>\n                    <td className=\"px-3 py-2 text-right\">\n                      <input className=\"w-28 text-right border rounded-md px-2 py-1\" value={rows[idx].prev}\n                        onChange={e=>{ const c=[...rows]; c[idx].prev=e.target.value; setRows(c); }} />\n                    </td>\n                    <td className=\"px-3 py-2 text-right\">\n                      <input className=\"w-28 text-right border rounded-md px-2 py-1\" value={rows[idx].curr}\n                        onChange={e=>{ const c=[...rows]; c[idx].curr=e.target.value; setRows(c); }} />\n                    </td>\n                    <td className=\"px-3 py-2 text-right\">\n                      <input className=\"w-28 text-right border rounded-md px-2 py-1\" value={rows[idx].prevFx}\n                        onChange={e=>{ const c=[...rows]; c[idx].prevFx=e.target.value; setRows(c); }} placeholder={rows[idx].ccy.toUpperCase()===\"TWD\"?\"1\":\"\"} />\n                    </td>\n                    <td className=\"px-3 py-2 text-right\">\n                      <input className=\"w-28 text-right border rounded-md px-2 py-1\" value={rows[idx].currFx}\n                        onChange={e=>{ const c=[...rows]; c[idx].currFx=e.target.value; setRows(c); }} placeholder={rows[idx].ccy.toUpperCase()===\"TWD\"?\"1\":\"\"} />\n                    </td>\n                    <td className=\"px-3 py-2 text-right\">{pct(r.localRet)}</td>\n                    <td className=\"px-3 py-2 text-right\">{pct(r.fxRet)}</td>\n                    <td className=\"px-3 py-2 text-right font-medium\">{pct(r.adjRet)}</td>\n                    <td className=\"px-3 py-2 text-right font-semibold\">{r.contrib.toFixed(3)}</td>\n                  </tr>\n                ))}\n              </tbody>\n              <tfoot>\n                <tr className=\"bg-slate-100 font-semibold\">\n                  <td className=\"px-3 py-2\" colSpan={2}>\u5408\u8a08</td>\n                  <td className=\"px-3 py-2 text-right\">{totals.totalWeight.toFixed(2)}%</td>\n                  <td className=\"px-3 py-2\" colSpan={7}></td>\n                  <td className=\"px-3 py-2 text-right\">\u2014</td>\n                  <td className=\"px-3 py-2 text-right\">{totals.totalPpts.toFixed(3)}</td>\n                </tr>\n              </tfoot>\n            </table>\n          </div>\n        </div>\n\n        <footer className=\"mt-8 text-xs text-slate-500\">\n          <div>\u00a9 \u540d\u611b\u8ecd \u00b7 NAV-Lag \u52a9\u624b \u00b7 \u4ee5 Core10/25 \u70ba\u4f30\u7b97\u57fa\u6e96\u3002\u82e5\u8981\u5168\u6301\u80a1\u7248\u672c\uff0c\u53ef\u64f4\u5145\u8cc7\u6599\u5217\u3002</div>\n          <div className=\"mt-2\">\n            <button onClick={runSelfTests} className=\"px-3 py-1.5 rounded-xl border shadow-sm\">\u57f7\u884c\u5167\u5efa\u6e2c\u8a66</button>\n            {testLog && <pre className=\"mt-2 whitespace-pre-wrap text-slate-600\">{testLog}</pre>}\n          </div>\n        </footer>\n      </div>\n    </div>\n  );\n}\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(<App />);\n";
        document.body.appendChild(app);
      }catch(err){
        showError(err.message || String(err));
      }
    })();
  </script>
</body>
</html>
